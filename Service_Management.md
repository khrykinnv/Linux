# Service Management
Управление службами в Linux контролирует системные демоны во время процессов загрузки/выключения. Современные дистрибутивы Linux используют systemd для управления службами с такими командами, как systemctl start/stop/restart/status/enable/disable. Службы выполняют различные фоновые функции независимо от пользовательских интерфейсов.

https://labex.io/tutorials/linux-how-to-master-linux-service-management-with-systemctl-392864

## Создание службы
Создание пользовательских служб в Linux включает написание файлов единиц служб systemd, которые определяют, как процессы должны запускаться, останавливаться и перезапускаться. Файлы служб размещаются в /etc/systemd/system/разделах [Unit], [Service] и [Install]

Расширение файла службы systemd — .service
```commandline
[Unit]
Description=Apache web server
After=network.target
Before=nextcloud-web.service

[Service]
ExecStart=/usr/local/apache2/bin/httpd -D FOREGROUND -k start
ExecReload=/usr/local/apache2/bin/httpd -k graceful
Type=notify
Restart=always


[Install]
WantedBy=default.target
RequiredBy=network.target
```
### Раздел [Unit]
Раздел Unit содержит сведения и описание самого блока. В нашем случае он содержит сведения о сервисе. Такие сведения, как «какое у него описание», «каковы его зависимости» и многое другое.
* Description:- Понятное для человека название службы systemd.
* After:- Установите зависимость от службы. Например, если вы настраиваете веб-сервер Apache, вы хотите, чтобы сервер запускался после того, как сеть будет подключена. Обычно это включает цели или другие службы.
* Before:- Запустить текущую службу перед указанной службой. В этом примере я говорю, что "Я хочу, чтобы веб-сервер Apache был запущен до запуска службы Nextcloud". Это потому, что в моем случае сервер Nextcloud зависит от веб-сервера Apache. Это также, как и After, включает цели или другие службы.

### Раздел [Service]
Содержит подробную информацию о порядке выполнения и прекращения службы.
* ExecStart:- Команда, которую необходимо выполнить при запуске сервиса. В нашем случае мы хотим запустить сервер Apache.
* ExecReload:- Это необязательное поле. Оно определяет, как перезапускается служба. Для служб, которые выполняют дисковый ввод-вывод (особенно запись на диск, например, база данных), лучше всего аккуратно завершить их и запустить снова. Используйте это поле, если вы хотите иметь определенный механизм перезапуска.
* Type:- Это указывает тип запуска процесса для данной службы systemd. Варианты: simple, exec, forking, oneshot, dbus, notify и idle. (подробнее здесь )
* Restart:- Это еще одно необязательное поле, но вы, скорее всего, будете его использовать. Оно указывает, следует ли перезапускать службу — в зависимости от обстоятельств — или нет. Доступные параметры: no, on-success, on-failure, on-abnormal, on-watchdog, on-abortи always.

### Раздел [Install]
Раздел Install, как следует из названия, управляет установкой файла systemd service/unit. Он используется при запуске команды systemctl enable и systemctl disable для включения или отключения службы.
* WantedBy:- Это похоже на поля Afterи Before, но главное отличие в том, что это используется для указания "уровней запуска", эквивалентных systemd. Это default.target происходит, когда вся инициализация системы завершена — когда пользователю предлагается войти в систему. Большинство служб, ориентированных на пользователя (например, Apache, cron, GNOME-stuff и т. д.), используют эту цель.
* RequiredBy:- Это поле может показаться очень похожим на WantedBy, но главное отличие в том, что это поле определяет жесткие зависимости . Это означает, что если зависимость, эта служба не будет работать.

https://linuxhandbook.com/create-systemd-services/

## Запуск и остановка служб
Управление службами Linux включает в себя управление системными службами, такими как базы данных, веб-серверы и сетевые службы. Используйте systemctl start service_nameдля запуска служб, systemctl stop service_nameих остановки и systemctl restart service_nameперезапуска. Эти команды требуют прав root через sudo и необходимы для системного администрирования и управления конфигурацией.

|  Команда |  Описание |
|---|---|
|  systemctl stop [service] | 	Начать службу.  |
| systemctl stop [service]  |  Остановить службу. |
|  systemctl enable [service] | Включите автоматический запуск службы при загрузке системы.  |
| systemctl disable [service]  |  Отключить автоматический запуск службы при загрузке системы. |
| systemctl status [service]  |  Просмотр статуса услуги. |
| systemctl restart [service]  |  Перезапустите службу. |
| systemctl reload [service]  |  Перезагрузить конфигурацию службы без ее перезапуска. |
| systemctl mask [service]  |  Запретить запуск службы. |
|  systemctl unmask [service] | 	Разрешить запуск ранее замаскированной службы.  |

https://linuxhandbook.com/systemctl-commands/

## Проверка журналов обслуживания
Системные журналы необходимы для устранения неполадок и мониторинга систем Linux.
Большинство журналов хранятся в ``/var/log`` каталоге и управляются systemd. Используйте ``journalctl`` для просмотра системных журналов и ``journalctl -u service_name`` журналов определенных служб. ``dmesg`` Команда отображает сообщения ядра.

https://linuxhandbook.com/journalctl-command/
































